name: X AI Tweet Generator
# Auto-generate AI tweets with Kutan-sensei

on:
  schedule:
    # æ¯æ—¥ 9æ™‚ï¼ˆJSTï¼‰ = 0æ™‚ï¼ˆUTCï¼‰
    - cron: '0 0 * * *'
    # æ¯æ—¥ 12æ™‚ï¼ˆJSTï¼‰ = 3æ™‚ï¼ˆUTCï¼‰
    - cron: '0 3 * * *'
    # æ¯æ—¥ 18æ™‚ï¼ˆJSTï¼‰ = 9æ™‚ï¼ˆUTCï¼‰
    - cron: '0 9 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯

jobs:
  generate-tweet:
    runs-on: ubuntu-latest
    
    permissions:
      issues: write
      contents: read
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install openai
    
    - name: Generate tweet
      id: generate
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        python generate_tweet.py
    
    - name: Get current time (JST)
      id: time
      run: |
        echo "jst_time=$(TZ=Asia/Tokyo date +'%Yå¹´%mæœˆ%dæ—¥ %H:%M')" >> $GITHUB_OUTPUT
    
    - name: Create GitHub Issue
      uses: actions/github-script@v7
      env:
        TWEET_CONTENT: ${{ steps.generate.outputs.tweet }}
        CHAR_COUNT: ${{ steps.generate.outputs.char_count }}
        JST_TIME: ${{ steps.time.outputs.jst_time }}
      with:
        script: |
          const tweet = process.env.TWEET_CONTENT;
          const charCount = process.env.CHAR_COUNT;
          const jstTime = process.env.JST_TIME;
          
          const issue = await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: `ğŸ¤– ããƒ¼ãŸã‚“åšå£«ã®ãƒ„ã‚¤ãƒ¼ãƒˆæ¡ˆ - ${jstTime}`,
            body: `## ğŸ“ ç”Ÿæˆã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆ

\`\`\`
${tweet}
\`\`\`

---

### ğŸ“Š è©³ç´°æƒ…å ±

- **æ–‡å­—æ•°**: ${charCount}/280
- **ç”Ÿæˆæ™‚åˆ»**: ${jstTime} (JST)
- **ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°**: #ç”ŸæˆAI #AI

---

### âœ… æŠ•ç¨¿æ–¹æ³•

1. ä¸Šè¨˜ã®ãƒ„ã‚¤ãƒ¼ãƒˆå†…å®¹ã‚’ã‚³ãƒ”ãƒ¼
2. [X (Twitter)](https://twitter.com/compose/tweet) ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ãƒ„ã‚¤ãƒ¼ãƒˆå†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¦æŠ•ç¨¿

---

### ğŸ”„ å†ç”Ÿæˆ

å†…å®¹ãŒæ°—ã«å…¥ã‚‰ãªã„å ´åˆã¯ã€[Actions](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/workflows/auto-generate.yml)ã‹ã‚‰æ‰‹å‹•ã§å†å®Ÿè¡Œã§ãã¾ã™ã€‚

---

*ã“ã®Issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ by GitHub Actions*
`,
            labels: ['tweet', 'auto-generated']
          });
          
          console.log(\`Issue created: #\${issue.data.number}\`);
    
    - name: Upload logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: tweet-logs
        path: tweet_generator.log
        retention-days: 30

